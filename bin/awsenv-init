#!/usr/bin/env bash

set -e
[ -n "$AWSENV_DEBUG" ] && set -x

if [ $# -eq 0 ]; then
    awsenv version
    echo "usage: awsenv init <environment>"
    echo ""
    echo "error: no argument given." >&2
    echo "hint:  use '-' to load the environment selected with 'awsenv use'."
    exit 1
fi

AWSENV_ROOT="$(awsenv root)"

if [ "$1" == "-" ]; then 
    CURRENT="$(awsenv current)"

    if [ "$CURRENT" == "" ]; then
        awsenv version
        echo "error: you have to set a environment with 'awsenv use' first." >&2
        exit 1
    fi
else
    CURRENT="$1"
fi

ENVIRONMENT="$AWSENV_ROOT/envs/$CURRENT"

if [ ! -d "$ENVIRONMENT" ]; then
    awsenv version
    echo "error: there is no environment named '$CURRENT'." >&2
    exit 1
fi

awsenv rehash

echo "error: not implemented yet." >&2
exit 1
